<!doctype html><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Space+Mono&display=swap" rel=stylesheet><html lang=en dir=ZgotmplZ><link href=https://github.com/VegaDeftwing rel=me><link rel=webmention href=https://webmention.io/opguides.info/webmention><link rel=pingback href=https://webmention.io/opguides.info/xmlrpc><script src=/webmention.min.js async></script><script src=/footnotes.js></script><script src=/js/egg.min.js></script><script>var egg=new Egg("d,e,v",function(){for(var t=document.getElementsByClassName("egg"),e=0;e<t.length;e++)t[e].removeAttribute("hidden")}).listen()</script><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Chapter 17 - We&rsquo;ve got cores, let&rsquo;s use em' # Hey kid, Wanna go fast? Okay, so here&rsquo;s the deal. Computers are generally really fast at crunching numbers. So fast, that the vast majority of the time the complexity introduced by trying to use multiple cores/threads isn&rsquo;t worth it … as long as all you&rsquo;re doing is crunching numbers.
The problem is you probably, yunno&rsquo;, want to do something with the output."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><style>a{color:#42b9f3}a:active{color:#42b9f3}::-webkit-scrollbar-thumb{background:#009cdf!important}::-webkit-scrollbar-thumb{background:#009cdf!important}</style><meta property="og:title" content><meta property="og:description" content="Chapter 17 - We&rsquo;ve got cores, let&rsquo;s use em' # Hey kid, Wanna go fast? Okay, so here&rsquo;s the deal. Computers are generally really fast at crunching numbers. So fast, that the vast majority of the time the complexity introduced by trying to use multiple cores/threads isn&rsquo;t worth it … as long as all you&rsquo;re doing is crunching numbers.
The problem is you probably, yunno&rsquo;, want to do something with the output."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/engineering/programming/multithread/"><meta property="article:section" content="engineering"><title>Multithread | Opinionated Guides</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.2bf0a8991b63fcb04b01fce847b895d364e7cb55987f09e20b04003ef243ea21.css integrity="sha256-K/ComRtj/LBLAfzoR7iV02Tny1WYfwniCwQAPvJD6iE=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script><script defer src=/en.search.min.2e0b0baf40b535d78ad592ccfc5694b71759169da3d62b793039b3e69713f4c3.js integrity="sha256-LgsLr0C1NdeK1ZLM/FaUtxdZFp2j1it5MDmz5pcT9MM=" crossorigin=anonymous></script><script src=/sw-register.js></script></head><body dir=ZgotmplZ><script src=https://unpkg.com/@h0rn0chse/night-sky/dist/bundle.min.js></script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "c6f9eeb56e4645ee9ca07afbee7e0462"}'></script><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><img src=/nonfree/logo/opguide2.png alt=Logo id=logo style="float:left;margin:10px 10px 0 0"><span>Opinionated Guides</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><div class=navbak style="background:#009cdf;> <ul> <li><a href=" /engineering/engineering/"><strong>Engineering</strong></a></li></ul></div><p class=navhead style=color:#009cdf;margin-bottom:0>    Introduction</p><div class=progress-ww><dl><dt>0 </dt><dd><a href=/engineering/engineering/>What is this?</a></dd><dt>Ⅰ </dt><dd><a href=/engineering/intro/community/>Community</a></dd><dt>Ⅱ </dt><dd><a href=/engineering/intro/howtolearn/>Learn How to Learn</a></dd><dt>EXT</dt><dd><a href=https://soatok.blog/2020/06/08/furward-momentum-introduction/>Furward Momentum</a></dd></dil></div><p class=navhead style=color:#009cdf;margin-bottom:0>    Linux & Your Computer</p><div class=progress-ww><dl><dt>1 </dt><dd><a href=/engineering/linux/firstgoal/>The First Goal</a></dd><dt>2 </dt><dd><a href=/engineering/linux/arch/>Installing Arch Linux</a></dd><dt>3 </dt><dd><details id=hardwareMenu><summary><a href=/engineering/linux/hardware/>Into The Hardware</a></summary><dt class=sub>.1 </dt><dd class=sub><a href=/engineering/linux/hardware/cpu> CPU</a></dd><dt class=sub>.2 </dt><dd class=sub><a href=/engineering/linux/hardware/ram> RAM</a></dd><dt class=sub>.3 </dt><dd class=sub><a href=/engineering/linux/hardware/motherboard> Motherboard</a></dd><dt class=sub>.4 </dt><dd class=sub><a href=/engineering/linux/hardware/gpu> Graphics</a></dd><dt class=sub>.5 </dt><dd class=sub><a href=/engineering/linux/hardware/storage> Storage</a></dd><dt class=sub>.6 </dt><dd class=sub><a href=/engineering/linux/hardware/network> Networking</a></dd><dt class=sub>.7 </dt><dd class=sub><a href=/engineering/linux/hardware/power> Power</a></dd><dt class=sub>.8 </dt><dd class=sub><a href=/engineering/linux/hardware/cooling> Cooling</a></dd><dt class=sub>.9 </dt><dd class=sub><a href=/engineering/linux/hardware/peripherals> Peripherals</a></dd><dt class=sub>.10</dt><dd class=sub><a href=/engineering/linux/hardware/biggerpicture> The Bigger Picture</a></dd><dt class=sub>.11</dt><dd class=sub><a href=/engineering/linux/hardware/buying> What to Buy?</a></dd><dt class=sub>.12</dt><dd class=sub><a href=/engineering/linux/hardware/legacy> Legacy</a></dd></details></dd><dt>3½</dt><dd><a href=/engineering/linux/hardware/architectures/>Architectures</a></dd><dt>4 </dt><dd><a href=/engineering/linux/linuxdirtree/>Getting Rooted in Linux</a></dd><dt>5 </dt><dd><a href=/engineering/linux/howwework/>Working on <i>How</i> we work</a></dd><dt>5½</dt><dd><a href=/engineering/linux/git/>Git</a></dd><dt>A1</dt><dd><a href=/engineering/linux/linuxshell/>Using The Linux Shell</a></dd><dt>A2</dt><dd><a href=/engineering/linux/windows/>Ugh. Windows.</a></dd></dil></div><p class=navhead style=color:#009cdf;margin-bottom:0>    Prerequisites</p><div class=progress-ww><dl><dt>6 </dt><dd><details id=mathMenu><summary><a href=/engineering/math/math/>Math</a></summary><dt class=sub>.1</dt><dd class=sub><a href=/engineering/math/algebra> Algebra</a></dd><dt class=sub>.2</dt><dd class=sub><a href=/engineering/math/logic> Logic</a></dd><dt class=sub>.3</dt><dd class=sub><a href=/engineering/math/geometry> Geometry & Trig</a></dd><dt class=sub>.4</dt><dd class=sub><a href=/engineering/math/calc> Calculus</a></dd><dt class=sub>.5</dt><dd class=sub><a href=/engineering/math/diffeq> Diff Eq</a></dd><dt class=sub>.6</dt><dd class=sub><a href=/engineering/math/linalg> Linear Algebra</a></dd><dt class=sub>.7</dt><dd class=sub><a href=/engineering/math/numanalysis> Numerical Analysis</a></dd><dt class=sub>.8</dt><dd class=sub><a href=/engineering/math/settheory> Set Theory</a></dd><dt class=sub>.9</dt><dd class=sub><a href=/engineering/math/probability> Probability</a></dd><dt class=sub>.10</dt><dd class=sub><a href=/engineering/math/newmath> New Math</a></dd></details></dd><dt>6½</dt><dd><a href=/engineering/math/units/>Units</a></dd><dt>7 </dt><dd><a href=/engineering/prereq/physics/>Physics</a></dd><dt>8 </dt><dd><a href=/engineering/prereq/chem/>Chemistry</a></dd><dt>9 </dt><dd><a href=/engineering/prereq/othersubjects/>'The Rest'</a></dd></dil></div><p class=navhead style=color:#009cdf;margin-bottom:0>    Programming</p><div class=progress-ww><dl></dd><dt>10 </dt><dd><details id=codeMenu><summary><a href=/engineering/programming/intro/prog0intro>Let's Write Some Code</a></summary><dt class=sub>.1 </dt><dd class=sub><a href=/engineering/programming/intro/prog1math> It's Math?</a></dd><dt class=sub>.2 </dt><dd class=sub><a href=/engineering/programming/intro/prog2turtle> Turtles!</a></dd><dt class=sub>.3 </dt><dd class=sub><a href=/engineering/programming/intro/prog3tools> Getting Tools</a></dd><dt class=sub>.4 </dt><dd class=sub><a href=/engineering/programming/intro/prog4comments> Knowing our Tools</a></dd><dt class=sub>.5 </dt><dd class=sub><a href=/engineering/programming/intro/prog5two> 2 for 1</a></dd><dt class=sub>.6 </dt><dd class=sub><a href=/engineering/programming/intro/prog6types> Types</a></dd><dt class=sub>.7 </dt><dd class=sub><a href=/engineering/programming/intro/prog7logic> logic & Functions</a></dd><dt class=sub>.8 </dt><dd class=sub><a href=/engineering/programming/intro/prog8oo> Data Structures</a></dd><dt class=sub>.9 </dt><dd class=sub><a href=/engineering/programming/intro/prog9stdlib> Libraries</a></dd><dt class=sub>.10</dt><dd class=sub><a href=/engineering/programming/intro/prog10> Rest of the Owl</a></dd><dt class=sub>.11</dt><dd class=sub><a href=/engineering/programming/intro/progendreal> Getting Real</a></dd></details></dd><dt>11 </dt><dd><a href=/engineering/programming/bestpractices/>Best Practices</a></dd><dt>11½</dt><dd><a href=/engineering/programming/ethics/>Ethics & Copyright</a></dd><dt>12 </dt><dd><a href=/engineering/programming/lifeofcode/>Life Of Code</a></dd><dt>13 </dt><dd><a href=/engineering/programming/fixxingissuses/>Fixing Issues</a></dd><dt>14 </dt><dd><a href=/engineering/programming/lowlvl/>Low Level Programming</a></dd><dt>15 </dt><dd><a href=/engineering/programming/algorithms/>Algorithms and More</a></dd><dt>15½</dt><dd><a href=/engineering/programming/data/>Data is hard</a></dd><dt>16 </dt><dd><a href=/engineering/programming/gitcicd/>Git, Testing, CI & CD</a></dd><dt>17 </dt><dd><a href=/engineering/programming/multithread/ class=active>We've Got Cores!</a></dd><dt>18 </dt><dd><a href=/engineering/programming/guiprog/>Graphical Programming</a></dd><dt>19 </dt><dd><a href=/engineering/programming/shaders/>Shaders + GpGPU</a></dd><dt>20 </dt><dd><a href=/engineering/programming/funcprog/>(((())(()((()(()))))))</a></dd><dt>21 </dt><dd><a href=/engineering/programming/game/>Game Programming</a></dd><dl><dt>22 </dt><dd><details id=compilersMenu><summary><a href=/engineering/programming/compilers/intro/>Custom Languages</a></summary><dt class=sub>.1 </dt><dd class=sub><a href=/engineering/programming/compilers/prelude/> Prelude</a></dd><dt class=sub>.2 </dt><dd class=sub><a href=/engineering/programming/compilers/lexing/> Lexing</a></dd><dt class=sub>.3 </dt><dd class=sub><a href=/engineering/programming/compilers/parsing/> Parsing</a></dd><dt class=sub>.4 </dt><dd class=sub><a href=/engineering/programming/compilers/translation/> Translation</a></dd><dt class=sub>.5 </dt><dd class=sub><a href=/engineering/programming/compilers/generation/> Code Generation</a></dd><dt class=sub>.5 </dt><dd class=sub><a href=/engineering/programming/compilers/intermezzo/> Intermezzo</a></dd><dt class=sub>.6 </dt><dd class=sub><a href=/engineering/programming/compilers/commands/> Commands</a></dd><dt class=sub>.7 </dt><dd class=sub><a href=/engineering/programming/compilers/subroutines/> Subroutines</a></dd><dt class=sub>.8 </dt><dd class=sub><a href=/engineering/programming/compilers/conditionals/> Conditionals</a></dd><dt class=sub>.9 </dt><dd class=sub><a href=/engineering/programming/compilers/variables/> Variables</a></dd><dt class=sub>.10</dt><dd class=sub><a href=/engineering/programming/compilers/conclusion/> Conclusion</a></dd></details></dd></dil><dt>A3 </dt><dd><a href=/engineering/programming/languages/>Programming Languages</a></dd></div><p class=navhead style=color:#009cdf;margin-bottom:0>    Circuits</p><div class=progress-ww><dl><dl><dt>23 </dt><dd><details id=Circuits1Menu><summary><a href=/engineering/circuits/intro/1-intro/>Circuits!</a></summary><dt class=sub>.1 </dt><dd class=sub><a href=/engineering/circuits/intro/2-tools/> Tools</a></dd><dt class=sub>.2 </dt><dd class=sub><a href=/engineering/circuits/intro/3-lcr/> ⅏ ⟛ Ω</a></dd><dt class=sub>.3 </dt><dd class=sub><a href=/engineering/circuits/intro/4-sim/> Simulation</a></dd></details></dd></dil><dt>24 </dt><dd><a href=/engineering/circuits/circuits2/>Semiconductors</a></dd><dt>24½</dt><dd><a href=/engineering/circuits/parts/>Parts</a></dd><dt>25 </dt><dd><a href=/engineering/circuits/digitallogic/>Digital Logic</a></dd><dt>26 </dt><dd><a href=/engineering/circuits/embedded/>Embedded Systems</a></dd><dt>27 </dt><dd><a href=/engineering/circuits/pcb/>Let's Make our own PCB</a></dd></dil></div><p class=navhead style=color:#009cdf;margin-bottom:0>    Signal Processing</p><div class=progress-ww><dl><dt>28 </dt><dd><a href=/engineering/signals/sigandsys>Signals & Systems</a></dd><dt>29 </dt><dd><a href=/engineering/signals/commsys>Communications</a></dd><dt>30 </dt><dd><a href=/engineering/signals/dsp>DSP</a></dd><dt>31 </dt><dd><a href=/engineering/signals/controlsys>Control Systems</a></dd><dt>32 </dt><dd><a href=/engineering/signals/compvision/>Computer Vision</a></dd><dt>33 </dt><dd><a href=/engineering/signals/aiml/>Fine, here's AI/ML</a></dd></dil></div><p class=navhead style=color:#009cdf;margin-bottom:0>    Going Deeper</p><div class=progress-ww><dl><dt>34 </dt><dd><a href=/engineering/deeper/compileassemble/>Compilers & Assemblers</a></dd><dt>35 </dt><dd><a href=/engineering/deeper/reverse/>Reverse Engineering</a></dd><dt>36 </dt><dd><a href=/engineering/deeper/fpga1/>Programmable Logic</a></dd><dt>37 </dt><dd><a href=/engineering/deeper/comparch/>Let's Make our own CPU</a></dd><dt>37½</dt><dd><a href=/engineering/deeper/nonsilicon/>Why Just Silicon?</a></dd></dil></div><p class=navhead style=color:#009cdf;margin-bottom:0>    Networking & Servers</p><div class=progress-ww><dl><dt>38 </dt><dd><details id=netMenu><summary><a href=/engineering/networking/networking/>Networking</a></summary><dt class=sub>.1</dt><dd class=sub><a href=/engineering/networking/howyougothere> How You Got Here</a></dd><dt class=sub>.2</dt><dd class=sub><a href=/engineering/networking/osi> OSI</a></dd><dt class=sub>.3</dt><dd class=sub><a href=/engineering/networking/tools> Tools</a></dd></details></dd><dt>39 </dt><dd><a href=/engineering/networking/servers/>Servers!</a></dd><dt>30½</dt><dd><a href=/engineering/networking/cloud/>"The Cloud"</a></dd><dt>40 </dt><dd><a href=/engineering/networking/databases/>Databases</a></dd><dt>41 </dt><dd><a href=/engineering/networking/security/>Security & Exploitation</a></dd><dt>41½</dt><dd><a href=/engineering/networking/privacy/>Privacy</a></dd></dil></div><p class=navhead style=color:#009cdf;margin-bottom:0>    Making & Hobbies</p><div class=progress-ww><dl><dt>42 </dt><dd><a href=/engineering/making/3dprint/>3D Printing & CNC</a></dd><dt>43 </dt><dd><a href=/engineering/making/hamradio/>Ham Radio</a></dd><dt>44 </dt><dd><a href=/engineering/making/history/>Computer History</a></dd><dt>45 </dt><dd><a href=/engineering/making/mechanical/>Mechanical</a></dd></dil></div><p class=navhead style=color:#009cdf;margin-bottom:0>    Wrapping Up</p><div class=progress-ww><dl><dt>46 </dt><dd><a href=/engineering/wrappingup/wrappingup/>Where next?</a></dd><dt>A3 </dt><dd><a href=/engineering/wrappingup/cheat/>Cheat Sheets & Libraries</a></dd><dt>A4 </dt><dd><a href=/engineering/wrappingup/resources/>Other Great Resources</a></dd><dt>A5 </dt><dd><a href=/engineering/wrappingup/job/>Getting a Job</a></dd><dt>A6 </dt><dd><a href=/engineering/wrappingup/latex/>Markdown and LaTeX</a></dd></dil></div><hr><div class=navbak style=background:#973999><ul><li><strong>Music</strong></li></ul></div></div><div class=progress-ww><dl><dt>1 </dt><dd><a href=/music/intro>Bang Zwoop Bada-dap-bap</a></dd><dt>2 </dt><dd><a href=/music/gettingstarted/>Getting Started</a></dd><dt>3 </dt><dd><a href=/music/gettingstartedcont/>On We Go</a></dd><dt>4 </dt><dd><a href=/music/sound-sources/>Sound Sources</a></dd><dt>5 </dt><dd><details id=instMenu><summary><a href=/music/instruments/>Instruments</a></summary><dt class=sub>.1</dt><dd class=sub><a href=/music/instruments/perc/> Percussion</a></dd><dt class=sub>.2</dt><dd class=sub><a href=/music/instruments/strings/> Strings</a></dd><dt class=sub>.3</dt><dd class=sub><a href=/music/instruments/wind/> Wind</a></dd><dt class=sub>.4</dt><dd class=sub><a href=/music/instruments/synth/> Synths</a></dd><dt class=sub>.5</dt><dd class=sub><a href=/music/instruments/esoteric/> The Esoteric</a></dd></details></dd><dt>6 </dt><dd><details id=effectMenu><summary><a href=/music/effects/>Effects</a></summary><dt class=sub>.1</dt><dd class=sub><a href=/music/effects/trivial/> Trivial Effects</a></dd><dt class=sub>.2</dt><dd class=sub><a href=/music/effects/time/> Time Based Effects</a></dd><dt class=sub>.3</dt><dd class=sub><a href=/music/effects/filter/> Filters!</a></dd><dt class=sub>.4</dt><dd class=sub><a href=/music/effects/dynamics/> Dʸⁿᵃᵐᶦᶜˢ</a></dd><dt class=sub>.5</dt><dd class=sub><a href=/music/effects/misc/> Everything Else</a></dd><dt class=sub>.6</dt><dd class=sub><a href=/music/effects/meta/> Meta</a></dd></details></dd><dt>7 </dt><dd><a href=/music/seqandmidi/>Sequencing & MIDI</a></dd></details></dd><dt>8 </dt><dd><details id=softMenu><summary><a href=/music/software/music-software>Software</a></summary><dt class=sub>.1</dt><dd class=sub><a href=/music/software/daw> DAW?</a></dd><dt class=sub>.2</dt><dd class=sub><a href=/music/software/plugin/> Plugins!</a></dd><dt class=sub>.3</dt><dd class=sub><a href=/music/software/livecoding/> Live Code</a></dd></details></dd><dt>8½</dt><dd><a href=/music/midi/>MIDI in Detail</a></dd><dt>9 </dt><dd><a href=/music/music-hardware/>Hardware</a></dd><dt>10 </dt><dd><a href=/music/theory/>Theory</a></dd><dt>11 </dt><dd><a href=/music/mix-and-master/>Mixing & Mastering</a></dd><dt>12 </dt><dd><a href=/music/lyrics/>Lyrics</a></dd><dt>13 </dt><dd><a href=/music/psychoacoustic/>Psychoacoustics</a></dd><dt>A1 </dt><dd><a href=/music/other-resources-music/>Other Resources</a></dd><dt>A2 </dt><dd><a href=/music/video/>Video</a></dd><dt>A3 </dt><dd><a href=/music/vcv/>VCV Tips</a></dd><dt>A4 </dt><dd><a href=/music/musicpiracy/>Piracy</a></dd></dil></div><hr><div class=navbak style=background:#e23838><ul><li><strong>Philosophy</strong></li></ul></div><div class=progress-ww><dl><dt>1 </dt><dd><a href=/phil/basic-phil/>Basic Philosophy</a></dd><dt>2 </dt><dd><a href=/phil/fallacies/>Logical Fallacies+</a></dd><dt>3 </dt><dd><a href=/phil/arguments/>Arguments</a></dd><dt>4 </dt><dd><a href=/phil/idea-labs/>Community Idea Labs</a></dd><dt>5 </dt><dd><a href=/phil/community/>Community Efforts</a></dd><dt>6 </dt><dd><a href=/phil/education/>Education</a></dd><dt>7 </dt><dd><a href=/phil/labor/>Labor & Compensation</a></dd><dt>8 </dt><dd><a href=/phil/copyright/>Copyright</a></dd><dt>9 </dt><dd><a href=/phil/consumerism/>Consumerism</a></dd><dt>10 </dt><dd><a href=/phil/law-and-order/>Law & Order</a></dd><dt>11 </dt><dd><a href=/phil/infrastructure/>Infrasturcture</a></dd><dt>12 </dt><dd><a href=/phil/environment/>Environment</a></dd><dt>13 </dt><dd><a href=/phil/religion/>Religion</a></dd><dt>14 </dt><dd><a href=/phil/sex/>Sex</a></dd><dt>15 </dt><dd><a href=/phil/medical/>Medical</a></dd><dt>16 </dt><dd><a href=/phil/foriegn/>Foriegn Involvement</a></dd><dt>17 </dt><dd><a href=/phil/voting/>Voting</a></dd><dl><dt>18 </dt><dd><details id=freedomMenu><summary><a href=/phil/freedoms/freedoms/>Freedoms</a></summary><dt class=sub>.1 </dt><dd class=sub><a href=/phil/freedoms/speech/> Speech</a></dd><dt class=sub>.2 </dt><dd class=sub><a href=/phil/freedoms/press/> Press</a></dd><dt class=sub>.3 </dt><dd class=sub><a href=/phil/freedoms/search/> Search & Seizure</a></dd><dt class=sub>.4 </dt><dd class=sub><a href=/phil/freedoms/fairtrial/> Fair Trial</a></dd><dt class=sub>.5 </dt><dd class=sub><a href=/phil/freedoms/body/> Bodily Autonomy</a></dd><dt class=sub>.6 </dt><dd class=sub><a href=/phil/freedoms/environmentalconcern/> Environment</a></dd><dt class=sub>.7 </dt><dd class=sub><a href=/phil/freedoms/travel/> Travel</a></dd><dt class=sub>.8 </dt><dd class=sub><a href=/phil/freedoms/armament/> Armament</a></dd><dt class=sub>.9 </dt><dd class=sub><a href=/phil/freedoms/recording/> Recording</a></dd><dt class=sub>.10</dt><dd class=sub><a href=/phil/freedoms/ownership> Ownership</a></dd><dt class=sub>EXT</dt><dd class=sub><a href=https://anewdigitalmanifesto.com> Digital Manifesto</a></dd></details></dd><dt>19 </dt><dd><a href=/phil/duties/>Duties</a></dd><dt>20 </dt><dd><a href=/phil/phil-and-the-internet/>Internet</a></dd><dt>21 </dt><dd><a href=/phil/economics/>Economics</a></dd><dt>22 </dt><dd><a href=/phil/history/>History</a></dd><dt>21 </dt><dd><a href=/phil/phil-misc/>Misc</a></dd><dt>A1 </dt><dd><a href=/phil/phil-other/>Other Resources</a></dd></dil></div><hr><div class=navbak style=background:#f78200><ul><li><strong>Design</strong></li></ul></div><div class=progress-ww><dl><dt>EXT</dt><dd><a href="https://www.youtube.com/watch?v=5Tx6U5OhMDg&list=PL6haVw-BFETw13kBFhbWl6UCshzgIC7Ea">Catastrovtivity</a></dd><dt>1 </dt><dd><a href=/design/basics/>Basics of Art</a></dd><dt>1½</dt><dd><a href=/design/vbasics/>Basics++</a></dd><dt>2 </dt><dd><a href=/design/analog/>Analog Art</a></dd><dt>3 </dt><dd><a href=/design/digital/>Digital Art</a></dd><dt>3½</dt><dd><a href=/design/dacadc/>DAC/ADC</a></dd><dt>4 </dt><dd><a href=/design/ui/>UI/UX</a></dd><dt>5 </dt><dd><a href=/design/3d/>3D</a></dd><dt>6 </dt><dd><a href=/design/gen/>Generative Tools</a></dd><dt>7 </dt><dd><a href=/design/animation/>Animation</a></dd><dt>A1 </dt><dd><a href=/design/design-other/>Other Resources</a></dd><dt>A2 </dt><dd><a href=/design/ia/>Inspirational Art</a></dd><dt>A3 </dt><dd><a href=/design/photo/>Photo</a></dd></dil></div><p class="navhead, webhead" style="background:linear-gradient(90deg,#F78200 0%,#FFF 50%,#009CDF 75%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:0">    Web Development</p></div><div class=progress-ww><dl><dt>1 </dt><dd><a href=/design/web/jack/>Jack of all trades</a></dd><dt>2 </dt><dd><a href=/design/web/garden/>Your own garden</a></dd></details></dd><dt>3 </dt><dd><details id=webMenu><summary><a href=/design/web/langs>HTML, CSS, JS, WUT?</a></summary><dt class=sub>.1</dt><dd class=sub><a href=/design/web/langs/html/> HTML</a></dd><dt class=sub>.2</dt><dd class=sub><a href=/design/web/langs/css/> CSS</a></dd><dt class=sub>.3</dt><dd class=sub><a href=/design/web/langs/js/> JS</a></dd></details></dd><dt>4 </dt><dd><a href=/design/web/static/>Static & Dynamic</a></dd><dt>5 </dt><dd><a href=/design/web/cost/>Cost?</a></dd><dt>6 </dt><dd><a href=/design/web/setup/>Getting Setup</a></dd><dt>7 </dt><dd><a href=/design/web/content/>Content is King</a></dd><dt>8 </dt><dd><a href=/design/web/thinkingweb/>Thinking Web</a></dd><dt>8½</dt><dd><a href=/design/web/access/>Accessability</a></dd><dt>A1 </dt><dd><a href=/design/web/tools/>Web development tools</a></dd><dt>A2 </dt><dd><a href=/design/web/resources/>Other Resources</a></dd></dil></div><hr><div class=navbak style=background:#ffb900><ul><li><strong>Interviews</strong></li></ul></div><div class=progress-ww><dl><dt> </dt><dd><a href=/interviews/loial/>Loial Otter</a></dd><dt> </dt><dd><a href=/interviews/soatok/>Soatok Dreamseeker</a></dd><dt> </dt><dd><a href=/interviews/cadeyratio/>Cadey Ratio</a></dd><dt> </dt><dd><a href=/interviews/kell/>Kell Bengal</a></dd><dt> </dt><dd><a href=/interviews/taxbadger/>Tax Badger</a></dd><dt> </dt><dd><a href=/interviews/spg/>Sex Positive Gaming</a></dd><dt></dt><dd><a href=/interviews/cendyne/>Cendyne</a></dd><dt></dt><dd><a href=/interviews/wolfgun/>Wolfgun</a></dd><dt></dt><dd><a href=/interviews/paulshapera/>Paul Shapera</a></dd></dil></div><hr><div class=navbak style=background:#5ebd3e><ul><li><strong>Other</strong></li></ul></div><div class=progress-ww><dl><dt> </dt><dd><a href=/other/funlinks/>Interesting Links</a></dd><dt> </dt><dd><a href=/other/advice/>Advice</a></dd><p class=navhead style=color:#5ebd3e;margin-bottom:0>   Technical</p><dt></dt><dd><details id=hciMenu><summary><a href=/other/hci2/intro/>The Way We Interact With Computers Sucks</a></summary><dt class=sub>1</dt><dd class=sub><a href=/other/hci2/physical> The Physical</a></dd><dt class=sub>2</dt><dd class=sub><a href=/other/hci2/digital> The Digital</a></dd><dt class=sub>3</dt><dd class=sub><a href=/other/hci2/whatelse> What Is Needed?</a></dd><dt class=sub>4</dt><dd class=sub><a href=/other/hci2/contradictions> What Contradicts?</a></dd><dt class=sub>5</dt><dd class=sub><a href=/other/hci2/radicallychanging> Radically Changing</a></dd><dt class=sub>6</dt><dd class=sub><a href=/other/hci2/wrappingup> Wrapping Up</a></dd></details></dd><dt> </dt><dd><a href=/other/coolhardware/>Cool Hardware</a></dd><dt> </dt><dd><a href=/other/fediverse/>The Fediverse, ActivityPub, & The IndieWeb</a></dd><p class=navhead style=color:#5ebd3e;margin-bottom:0>   Conlangs & Neography</p><dt> </dt><dd><a href=/other/conlangs/tokipona/>toki pona! <span class=conlang>󱥬󱦖󱥔</span></a></dd><dt> </dt><dd><a href=/other/conlangs/janolin/>Thoughts on olin</a> <span style=font-size:.4rem>by jan Usawi</span><dt> </dt><dd><a href=/other/conlangs/rhapsodaic/>Rhapsodaic</a> <span style=font-size:.4rem>by jan Usawi</span></dd></dil></div><hr><div class=navbak style="background:linear-gradient(60deg,#f79533,#f37055,#ef4e7b,#a166ab,#5073b8,#1098ad,#07b39b,#6fba82);animation:animatedgradient 5s ease alternate infinite;background-size:300% 300%"><ul><li><b><a href=/posts/ style=color:#000!important>Blog<a></b></li></ul></div><div style=width:90%;margin:auto><dl><li class="flex justify-between"><dd><b><a href=/tags/>TAG</a></b><dt><b><dd class=blogdd style=color:#fff>№ of Posts</dt></b></li><hr><li class="flex justify-between"><dd><a href=/tags/personal/>Personal</a><dt><dd class=blogdd style=color:#fff>10</dt></li><li class="flex justify-between"><dd><a href=/tags/meta/>Meta</a><dt><dd class=blogdd style=color:#fff>2</dt></li><li class="flex justify-between"><dd><a href=/tags/music/>Music</a><dt><dd class=blogdd style=color:#fff>1</dt></li><li class="flex justify-between"><dd><a href=/tags/technical/>Technical</a><dt><dd class=blogdd style=color:#fff>11</dt></li><li class="flex justify-between"><dd><a href=/tags/art/>Art</a><dt><dd class=blogdd style=color:#fff>3</dt></li><li class="flex justify-between"><dd><a href=/tags/school/>School</a><dt><dd class=blogdd style=color:#fff>2</dt></li><li class="flex justify-between"><dd><a href=/tags/politics/>Politics</a><dt><dd class=blogdd style=color:#fff>2</dt></li></dil></li></div><br></nav><script>document.addEventListener("DOMContentLoaded",function(){var t=localStorage.getItem("storedScrollTop"),e=document.querySelector("body > main > aside.book-menu > nav");console.log("Menu after DOM element:",e),e.scrollTop=t}),window.onbeforeunload=function(){var e=document.querySelector("body > main > aside.book-menu > nav");console.log("Menu bufore unload element:",e),localStorage.setItem("storedScrollTop",e.scrollTop)}</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Multithread</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#chapter-17---weve-got-cores-lets-use-em>Chapter 17 - We&rsquo;ve got cores, let&rsquo;s use em'</a><ul><li><a href=#using-threads-to-wait-on-io>Using Threads To Wait On I/O</a></li><li><a href=#do-you-actually-need-speed>Do You Actually Need Speed?</a></li><li><a href=#simd>SIMD</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=chapter-17---weve-got-cores-lets-use-em>Chapter 17 - We&rsquo;ve got cores, let&rsquo;s use em'
<a class=anchor href=#chapter-17---weve-got-cores-lets-use-em>#</a></h1><div class="book-columns flex flex-wrap"><div class="flex-even markdown-inner"><img src=/nonfree/character/skate.avif alt="Skateboarding Vega"></div><div class="flex-even markdown-inner">Hey kid, Wanna go <em>fast</em>?</div></div><p>Okay, so here&rsquo;s the deal. Computers are generally really fast at crunching numbers. So fast, that the vast majority of the time the complexity introduced by trying to use multiple cores/threads isn&rsquo;t worth it … as long as all you&rsquo;re doing is crunching numbers.</p><p>The problem is you probably, yunno&rsquo;, want to do something with the output.</p><p>The slowest thing to do is wait on input or output. If you time how long it takes for a program written in even something &ldquo;fast&rdquo; like C to run you&rsquo;ll quickly realize it&rsquo;s basically instant right up until the point that you try to print something to the terminal. That &ldquo;Hello World&rdquo; will be limited by how fast the terminal can take those characters in.</p><p>The same applies to pretty much all other operations on the computer. It&rsquo;s very likely your limited by I/O blocking you from advancing.</p><p>The solution? Don&rsquo;t wait. Issue the job and come back later.</p><h2 id=using-threads-to-wait-on-io>Using Threads To Wait On I/O
<a class=anchor href=#using-threads-to-wait-on-io>#</a></h2><p>[TDOO] Motivations from Moore&rsquo;s law, Blocking I/O,</p><p>[TODO] start with process forking via syscall - show it</p><p><a href=https://lemire.me/blog/2020/01/30/cost-of-a-thread-in-c-under-linux/>https://lemire.me/blog/2020/01/30/cost-of-a-thread-in-c-under-linux/</a></p><p>C++ coroutines</p><p>not really threading, but process children</p><p>SIMD, <a href=https://nullprogram.com/blog/2021/12/04/>https://nullprogram.com/blog/2021/12/04/</a></p><h2 id=do-you-actually-need-speed>Do You Actually Need Speed?
<a class=anchor href=#do-you-actually-need-speed>#</a></h2><p>Before we go any further, it&rsquo;s important to note that, depending on what you&rsquo;re working on, you probably don&rsquo;t need this to optimize like we&rsquo;ll be talking about. There&rsquo;s a pretty high overhead to doing so.</p><ul><li>It makes debugging harder</li><li>It&rsquo;s harder to debug</li><li>It&rsquo;s harder to make cross-platform</li><li>It makes compatibility even on the same base architecture worse</li><li>It&rsquo;s a lot of time and effort that <em>might</em> be better spent doing something else</li></ul><p>I, personally, have only had a few times where the tradeoff made it make sense to go to this effort. Still, everything we&rsquo;re about to look at is stuff you should have in your toolbelt, just don&rsquo;t think you always need to use it.</p><h2 id=simd>SIMD
<a class=anchor href=#simd>#</a></h2><p>As long as you&rsquo;re not on a weak, embedded system CPU (and even on some of them, actually) your processor probably support some kind of <strong>S</strong>ingle <strong>I</strong>nstruction <strong>M</strong>ultiple <strong>D</strong>ata processing.</p><p>This, as the name implies, let&rsquo;s us pack data to be processed by one instruction. As a lame example, let&rsquo;s look at a function which just sums some numbers. Here&rsquo;s the most basic assembly:</p><pre tabindex=0><code class=language-assembly data-lang=assembly>sum(int*, int):                              # @sum(int*, int)
        test    esi, esi
        jle     .LBB0_1
        mov     ecx, esi
        xor     edx, edx
        xor     eax, eax
.LBB0_4:                                # =&gt;This Inner Loop Header: Depth=1
        add     eax, dword ptr [rdi + 4*rdx]
        inc     rdx
        cmp     rcx, rdx
        jne     .LBB0_4
        ret
.LBB0_1:
        xor     eax, eax
        ret
</code></pre><p>Even if reading x86_64 assembly is hard stare at it for a bit. The basic of it is we call <code>add</code> on line 8, increment <code>rdx</code>, check if it&rsquo;s exceeded the size of our array (<code>rcx</code>) and, if it hasn&rsquo;t, add the next value. Repeat. This is fine, but can we do better? YES!</p><p>You could do this:</p><pre tabindex=0><code class=language-assembly data-lang=assembly>sum(int*, int):                              # @sum(int*, int)
        test    esi, esi
        jle     .LBB0_1
        mov     ecx, esi
        cmp     esi, 32
        jae     .LBB0_4
        xor     edx, edx
        xor     eax, eax
        jmp     .LBB0_7
.LBB0_1:
        xor     eax, eax
        ret
.LBB0_4:
        mov     edx, ecx
        and     edx, 2147483616
        mov     eax, ecx
        shr     eax, 5
        and     eax, 67108863
        shl     rax, 7
        vpxor   xmm0, xmm0, xmm0
        xor     esi, esi
        vpxor   xmm1, xmm1, xmm1
        vpxor   xmm2, xmm2, xmm2
        vpxor   xmm3, xmm3, xmm3
.LBB0_5:                                # =&gt;This Inner Loop Header: Depth=1
        vpaddd  ymm0, ymm0, ymmword ptr [rdi + rsi]
        vpaddd  ymm1, ymm1, ymmword ptr [rdi + rsi + 32]
        vpaddd  ymm2, ymm2, ymmword ptr [rdi + rsi + 64]
        vpaddd  ymm3, ymm3, ymmword ptr [rdi + rsi + 96]
        sub     rsi, -128
        cmp     rax, rsi
        jne     .LBB0_5
        vpaddd  ymm0, ymm1, ymm0
        vpaddd  ymm1, ymm3, ymm2
        vpaddd  ymm0, ymm1, ymm0
        vextracti128    xmm1, ymm0, 1
        vpaddd  xmm0, xmm0, xmm1
        vpshufd xmm1, xmm0, 238                 # xmm1 = xmm0[2,3,2,3]
        vpaddd  xmm0, xmm0, xmm1
        vpsrlq  xmm1, xmm0, 32
        vpaddd  xmm0, xmm0, xmm1
        vmovd   eax, xmm0
        cmp     rdx, rcx
        je      .LBB0_8
.LBB0_7:                                # =&gt;This Inner Loop Header: Depth=1
        add     eax, dword ptr [rdi + 4*rdx]
        inc     rdx
        cmp     rcx, rdx
        jne     .LBB0_7
.LBB0_8:
        vzeroupper
        ret
</code></pre><div class="speech triode big"><p>But, that&rsquo;s more assembly, so more instructions! Shouldn&rsquo;t that be slower?</p></div><p>No. Remember lines of assembly ≠ executed lines. If you have one loop of 10 lines that runs 100 times, that&rsquo;s 1000 instructions. If you have one loop of 100 lines that runs 5 times times that&rsquo;s only 500, so it&rsquo;s still faster.</p><p>ANYWAY, I want to ignore a good 95% of this assembly as - and I can&rsquo;t stress this enough - you really shouldn&rsquo;t be writing stuff like this anyway unless you have a damn good reason. Assembly is hard to write and error prone. I mostly want to point out what&rsquo;s happening under the hood at a high level and I think, even if you can&rsquo;t read everything above in full, you&rsquo;ll see the general idea.</p><p>Basically, what&rsquo;s happening is this</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>while</span>(i <span style=color:#f92672>&lt;</span> size){
</span></span><span style=display:flex><span>    big_reg[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> arr[i <span style=color:#f92672>+</span> <span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>    big_reg[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> arr[i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>    big_reg[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> arr[i <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>];
</span></span><span style=display:flex><span>    big_reg[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> arr[i <span style=color:#f92672>+</span> <span style=color:#ae81ff>3</span>];
</span></span><span style=display:flex><span>    i <span style=color:#f92672>+=</span> <span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>    sum <span style=color:#f92672>+=</span> <span style=color:#a6e22e>magically_add_everything_in_big_reg_in_one_instruction</span>(big_reg)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>With some extra logic to handle if the array isn&rsquo;t a multiple of 4 in size.</p><p>That is, the CPU has these special registers which we can load data into and then tell it to operate on them with a special instruction that does everything all in one go. Sure, we still have to call the setup to load the values in, but we we&rsquo;re going to have to load them value-by-value anyway. Now we can save a bunch of work by doing all those <code>add</code>s in one call to <code>super_add</code>. This works because we have some special registers which can - even though we&rsquo;re on a 64 bit computer - work on more than 64-bits at a time. We just have to pack em&rsquo; up, do our thing, and take em&rsquo; out - or, ideally, keep the value in those packed registers until we <em>have to</em> covert back, since there is some overhead to the packing/unpacking.</p><p>Okay, so, we just looked at a lot of assembly, and I just told you you really, really shouldn&rsquo;t write assembly - so, what good does any of this do?</p><p>Well, first, to do this at the most basic level, you actually don&rsquo;t need to change any of your code. You just need to tell the compiler that your platform is capable of doing that, but, that&rsquo;s actually the first big snag here:</p><p>We&rsquo;re looking at <strong>assembly</strong>. You&rsquo;ll recall, assembly is architecture specific. So, there&rsquo;s <code>x86_64</code>, which most user-facing computers today use, <code>arm</code> which is used by most smartphones, and many many others you&rsquo;ll see occasionally.</p><p>But, that&rsquo;s only half the story. <code>x86_64</code> and <code>arm</code> both have a ton of optional extensions. Most modern systems should support the extensions to use these special instructions to do SIMD processing, but it does vary from processor to processor. If you&rsquo;re making a program you intend to distribute as a binary and want it to still work even if somebody is on an older system, you have to have a system for falling back on the simpler method. This, unfortunately, means needing to dynamically (at runtime) figure out which execution path to take. This is a small bit of overhead. The alternative would be shipping the software with assumed support for the extensions or multiple versions depending on the processor, but that means either expecting users to know which version to grab or not letting some people use the software at all.</p><p>Basically, this means you have to first decide who your software is for and how it will be distributed:</p><p>If you want distribute source, then most of this becomes a non issue, we&rsquo;ll just use compiler hints and lets the user compile it.</p><p>If you want to distribute binaries, then it depends on your users and the software&rsquo;s requirements.</p><ul><li>If they&rsquo;re technical, you might be able to get away with shipping multiple binaries.</li><li>If you think your software will run poorly without the optimizations, you might just say &ldquo;You must have a processor newer than 20xx or this software will not run check this [link here] list for compatibility&rdquo;.</li><li>If you think they&rsquo;re not technical, you don&rsquo;t think it&rsquo;s required, and you want to maintain compatibility in one binary, your best bet is to make it distinctly NOT your problem and to throw an open source library at it. The library you use - if using one at all makes sense - will depend on the language and what you&rsquo;re doing. It&rsquo;s likely that the part of your code you need to make fast is a known problem with a good, optimized to hell, library you can drop in for it.</li></ul><p>[TODO] Compiler options, using intinsics, pragmas, etc.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/VegaDeftwing/OpGuidesHugoSrc/tree/main/content//Engineering/Programming/multithread.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><hr><span><a href=https://webring.xxiivv.com/#random target=_blank><img id=webring-img src=https://webring.xxiivv.com/icon.white.svg style=width:100px;height:100px;opacity:.7></a></span><p>If you would like to support my development of OpGuides, please consider supporting me on <a href=https://github.com/sponsors/VegaDeftwing>GitHub Sponsors</a> or dropping me some spare change on Venmo @vegadeftwing - every little bit helps ❤️</p></footer><div id=webmentions></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#chapter-17---weve-got-cores-lets-use-em>Chapter 17 - We&rsquo;ve got cores, let&rsquo;s use em'</a><ul><li><a href=#using-threads-to-wait-on-io>Using Threads To Wait On I/O</a></li><li><a href=#do-you-actually-need-speed>Do You Actually Need Speed?</a></li><li><a href=#simd>SIMD</a></li></ul></li></ul></nav></div></aside></main></body></html>